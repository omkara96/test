INSERT INTO CIM_LC_INT.PRC_ULT_ACDMC_SCTY (
    LYT_CLS,
    RCR_ID,
    PRS_CD,
    PRS_CD_RSV,
    MDF_CLS,
    ACD_SCT_CD,
    RSV_ACD_SCT_MNT_CLS,
    MNT_DT,
    RSV_TRN_DT_VN,
    ACD_SCT_YR,
    SRC_LOAD_BATCH_ID,
    CRTN_ID,
    SYS_CRTN_DT_TM,
    LAST_UPDT_ID,
    SYS_LAST_UPDT_DT_TM,
    MDM_DMN_GEO_CD,
    INFO_SRC_CD,
    INFO_SRC_OBJ_NM,
    LOAD_KEY,
    OPERATION_FLAG,
    DA_SOURCE_CODE,
    DA_AREA_CODE
)
SELECT
    S.LYT_CLS,
    S.RCR_ID,
    S.PRS_CD,
    S.PRS_CD_RSV,
    S.MDF_CLS,
    S.ACD_SCT_CD,
    '1',
    S.PARENT_MNT_DT,
    S.RSV_TRN_DT_VN,
    S.ACD_SCT_YR,
    S.SRC_LOAD_BATCH_ID,
    S.CRTN_ID,
    S.SYS_CRTN_DT_TM,
    S.LAST_UPDT_ID,
    S.SYS_LAST_UPDT_DT_TM,
    S.MDM_DMN_GEO_CD,
    S.INFO_SRC_CD,
    S.INFO_SRC_OBJ_NM,
    S.LOAD_KEY,
    'D',
    S.DA_SOURCE_CODE,
    S.DA_AREA_CODE
FROM (
    SELECT
        C.*,
        P.MNT_DT AS PARENT_MNT_DT,
        P.LOAD_KEY
    FROM CIM_LC_INT.PRC_ULT_DCTR P
    JOIN CIM_LC_PRST.PRST_ULT_ACDMC_SCTY_C C ON C.PRS_CD = P.PRS_CD
        AND C.DA_AREA_CODE = P.DA_AREA_CODE
        AND C.DA_SOURCE_CODE = P.DA_SOURCE_CODE
    WHERE P.MDF_CLS = 'C'
        AND P.DA_AREA_CODE = 'pi_str_areaCode'
        AND P.DA_SOURCE_CODE = 'pi_str_sourceCode'
) S
LEFT JOIN CIM_LC_INT.PRC_ULT_ACDMC_SCTY T ON (
    S.PRS_CD = T.PRS_CD
    AND S.ACD_SCT_CD = T.ACD_SCT_CD
    AND S.DA_AREA_CODE = T.DA_AREA_CODE
    AND S.DA_SOURCE_CODE = T.DA_SOURCE_CODE
)
WHERE T.PRS_CD IS NULL;



UPDATE CIM_LC_INT.PRC_ULT_ACDMC_SCTY
SET
    RSV_ACD_SCT_MNT_CLS = '1',
    OPERATION_FLAG = 'D',
    MNT_DT = (
        SELECT P.MNT_DT AS PARENT_MNT_DT
        FROM CIM_LC_INT.PRC_ULT_DCTR P
        WHERE P.PRS_CD = CIM_LC_INT.PRC_ULT_ACDMC_SCTY.PRS_CD
            AND P.DA_AREA_CODE = CIM_LC_INT.PRC_ULT_ACDMC_SCTY.DA_AREA_CODE
            AND P.DA_SOURCE_CODE = CIM_LC_INT.PRC_ULT_ACDMC_SCTY.DA_SOURCE_CODE
    )
WHERE
    PRS_CD IN (
        SELECT P.PRS_CD
        FROM CIM_LC_INT.PRC_ULT_DCTR P
        JOIN CIM_LC_PRST.PRST_ULT_ACDMC_SCTY_C C ON C.PRS_CD = P.PRS_CD
            AND C.DA_AREA_CODE = P.DA_AREA_CODE
            AND C.DA_SOURCE_CODE = P.DA_SOURCE_CODE
        WHERE P.MDF_CLS = 'C'
            AND P.DA_AREA_CODE = 'pi_str_areaCode'
            AND P.DA_SOURCE_CODE = 'pi_str_sourceCode'
    )
    AND RSV_ACD_SCT_MNT_CLS <> '1';
