SELECT T.*, S.PARENT_MNT_DT, 'Matched' AS Match_Status
FROM CIM_LC_INT.PRC_ULT_ACDMC_SCTY_SPCLST T
JOIN (
    SELECT C.*, P.MNT_DT AS PARENT_MNT_DT, P.LOAD_KEY
    FROM CIM_LC_INT.PRC_ULT_DCTR P
    JOIN CIM_LC_PRST.PRST_ULT_ACDMC_SCTY_SPCLST_C C
        ON C.PRS_CD = P.PRS_CD
        AND C.DA_AREA_CODE = P.DA_AREA_CODE
        AND C.DA_SOURCE_CODE = P.DA_SOURCE_CODE
    WHERE P.MDF_CLS = 'C'
        AND P.DA_AREA_CODE = 'pi_str_areaCode'
        AND P.DA_SOURCE_CODE = 'pi_str_sourceCode'
) S
    ON S.PRS_CD = T.PRS_CD
    AND S.MDC_SPC_CD = T.MDC_SPC_CD
    AND S.DA_AREA_CODE = T.DA_AREA_CODE
    AND S.DA_SOURCE_CODE = T.DA_SOURCE_CODE
WHERE NVL(T.RSV_MDC_SPC_MNT_CLS, 'X') <> '1'
UNION ALL
SELECT S.LYT_CLS,
       S.RCR_ID,
       S.PRS_CD,
       S.PRS_CD_RSV,
       S.MDF_CLS,
       S.MDC_SPC_CD,
       '1' AS RSV_MDC_SPC_MNT_CLS,
       S.PARENT_MNT_DT AS MNT_DT,
       S.RSV_TRN_DT_VN,
       S.SPC_FLG,
       S.SPC_PBL_DT,
       S.CRT_PHY_FLG,
       S.CRT_PHY_PBL_DT,
       S.MDC_ADV_FLG,
       S.MDC_ADV_PBL_DT,
       S.SRC_LOAD_BATCH_ID,
       S.CRTN_ID,
       S.SYS_CRTN_DT_TM,
       S.LAST_UPDT_ID,
       S.SYS_LAST_UPDT_DT_TM,
       S.MDM_DMN_GEO_CD,
       S.INFO_SRC_CD,
       S.INFO_SRC_OBJ_NM,
       S.LOAD_KEY,
       'D' AS OPERATION_FLAG,
       S.DA_SOURCE_CODE,
       S.DA_AREA_CODE,
       'Unmatched' AS Match_Status
FROM (
    SELECT C.*, P.MNT_DT AS PARENT_MNT_DT, P.LOAD_KEY
    FROM CIM_LC_INT.PRC_ULT_DCTR P
    JOIN CIM_LC_PRST.PRST_ULT_ACDMC_SCTY_SPCLST_C C
        ON C.PRS_CD = P.PRS_CD
        AND C.DA_AREA_CODE = P.DA_AREA_CODE
        AND C.DA_SOURCE_CODE = P.DA_SOURCE_CODE
    WHERE P.MDF_CLS = 'C'
        AND P.DA_AREA_CODE = 'pi_str_areaCode'
        AND P.DA_SOURCE_CODE = 'pi_str_sourceCode'
) S
LEFT JOIN CIM_LC_INT.PRC_ULT_ACDMC_SCTY_SPCLST T
    ON S.PRS_CD = T.PRS_CD
    AND S.MDC_SPC_CD = T.MDC_SPC_CD
    AND S.DA_AREA_CODE = T.DA_AREA_CODE
    AND S.DA_SOURCE_CODE = T.DA_SOURCE_CODE
WHERE T.PRS_CD IS NULL;
